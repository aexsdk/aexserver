<?php	/* * 执行操: 自动入库 * */api_action($api_object);function get_message_callback($api_obj,$context,$msg){	return sprintf($msg,$api_obj->return_code, $api_obj->return_data['pno']);}/*	写回应信息的回调函数，设置了此函数会覆盖默认的输出方式，此函数只需要返回结果，输出由调用函数负责。*/function write_response_callback($api_obj,$context){	$resp = $api_obj->write_return_xml();	return $resp;}function api_action($api_obj){	require_once $api_obj->params['common-path'].'/api_wfs_db.php';	$wfs_db = new class_wfs_db($api_obj->config->new_wfs_db_config, $api_obj);	$api_obj->set_callback_func ( get_message_callback, write_response_callback, $wfs_db );	$bsn = isset($_REQUEST['bsn'])?$_REQUEST['bsn']:'ophone_bsn';	$imei = $_REQUEST['imei'];    	$carrier_name = $_REQUEST['carrier_name'];	$resaler = isset($_REQUEST['resaler'])?$_REQUEST['resaler']:'0';	$cp = isset($_REQUEST['chargeplan'])?$_REQUEST['chargeplan']:'';	$remark = isset($_REQUEST['remark'])?$_REQUEST['remark']:''; 	$return_data = new stdClass();	try {		$imeis = explode(',',$imei);		$return_data->imeis_success = array();		$return_data->imeis_fail = array();		foreach ($imeis as $imei){			if(trim($imei)=='')continue;			$r = $wfs_db->web_stock_update(array(				$bsn,				$imei,				$carrier_name,				$resaler,				$cp,				$remark			));			if($r > 0){				array_push($return_data->imeis_success,$imei);			}else{				array_push($return_data->imeis_fail,$imei);;			}		}		$return_data->success = true;	} catch ( Exception $e ) {		$return_data->success = false;		$return_data->message = $e->getMessage ();	}	echo $api_obj->json_encode($return_data);}?>